generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum CompanyTypesEnum {
  MATRIZ
  FILIAL
  MASTER
}

enum CompanyEnvironmentTypesEnum {
  GENERAL
  SUPPORT
  OPERATION
  ADMINISTRATIVE
}

enum HierarchyEnum {
  DIRECTORY 
  MANAGEMENT
  SECTOR
  SUB_SECTOR
  OFFICE
  SUB_OFFICE
}

enum RiskFactorsEnum {
  BIO 
  QUI
  FIS
  ERG
  ACI
}

enum StatusEnum {
  ACTIVE
  PROGRESS
  INACTIVE
  PENDING
  PROCESSING
  EXPIRED
  VALID
  INVALID
  ERROR
  CANCELED
  DONE
}

enum HomoTypeEnum {
  HIERARCHY
  ENVIRONMENT
  WORKSTATION
  EQUIPMENT
  ACTIVITIES
}

enum CharacterizationTypeEnum {
  WORKSTATION
  EQUIPMENT
  ACTIVITIES
  GENERAL
  SUPPORT
  OPERATION
  ADMINISTRATIVE
}

enum MeasuresTypeEnum {
  ADM
  ENG
}

enum RecTypeEnum {
  ADM
  ENG
  EPI
}

enum RiskRecTypeEnum {
  CANCELED
  POSTPONED
  DONE
}

enum RiskRecTextTypeEnum {
  MONEY
  TECHNIQUE
  LOGISTICS
  OTHER
}

// START TABLES

model AccessGroups {
  id    Int     @default(autoincrement()) @id
  roles String[]
  permissions String[]
  name String  
  description String?  
  companyId String  
  system Boolean @default(false)  
  users UserCompany[]
  invites InviteUsers[]
  company Company? @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade) 

  @@unique([id, companyId])
} 

model Activity {
  id    Int     @default(autoincrement()) @id
  code String @unique
  name String
  riskDegree Int @default(0)
  created_at DateTime @default(now())
  company_primary_activity Company[] @relation(name: "primary_activity")
  company_secondary_activity Company[] @relation(name: "secondary_activity")
}

model Address {
  id   String    @id @default(uuid())
  companyId String
  cep String 
  street String?
  number String?
  complement String?
  neighborhood String?
  city String?
  state String?
  workspaceId String?
  workspace Workspace? @relation(fields: [id,companyId], references: [id,companyId], onDelete: Cascade, onUpdate: Cascade)
  
  @@unique([workspaceId, companyId])
  @@unique([id,companyId])
}

model AddressCompany {
  id   String    @id @default(uuid())
  cep String 
  street String?
  number String?
  complement String?
  neighborhood String?
  city String?
  state String?
  companyId String @unique
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Attachments {
  id   String    @id @default(uuid())
  name String?  
  url String
  created_at DateTime @default(now())
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  riskFactorDocumentId String?
  riskFactorDocument RiskFactorDocument? @relation(fields: [riskFactorDocumentId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
}

model Checklist {
  id    Int     @default(autoincrement())
  status StatusEnum @default(PROGRESS)
  name String 
  companyId String
  system Boolean
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  data ChecklistData?
  created_at DateTime @default(now())

  @@id([id, companyId])
} 

model ChecklistData {
  json Json
  companyId String
  checklistId    Int  
  checklist Checklist @relation(fields: [checklistId,companyId], references: [id,companyId], onDelete: Cascade, onUpdate: Cascade)

  @@id([checklistId, companyId])
} 

model Company {
  id   String    @id @default(uuid())
  cnpj String
  name String  
  shortName String?
  fantasy String?
  description String?
  size String?
  legal_nature String?
  cadastral_situation String?
  activity_start_date String?
  cadastral_situation_date String?
  legal_nature_code String?
  cadastral_situation_description String?
  isConsulting Boolean @default(false)
  licenseId Int? 
  groupId Int? 
  phone String?
  email String?
  operationTime String?
  logoUrl String?
  responsibleName String?
  mission String?
  vision String?
  values String?
  created_at DateTime @default(now())
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  status StatusEnum @default(ACTIVE)
  type CompanyTypesEnum @default(MATRIZ)
  accessGroups AccessGroups[]
  address AddressCompany?
  applyingServiceContracts Contract[]  @relation(name: "contracts")
  characterization CompanyCharacterization[] 
  checklist Checklist[] 
  companyGroups CompanyGroup[] 
  databaseTable DatabaseTable[] 
  employees Employee[] 
  environments CompanyEnvironment[] 
  generateSource GenerateSource[] 
  group CompanyGroup? @relation(name:"group", fields: [groupId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  hierarchy Hierarchy[] 
  homogeneousGroup HomogeneousGroup[] 
  invites InviteUsers[] 
  license License? @relation(name:"license",fields: [licenseId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  primary_activity Activity[] @relation(name: "primary_activity")
  professionals Professional[]
  receivingServiceContracts Contract[]
  recMed RecMed[] 
  riskFactorData RiskFactorData[] 
  riskFactorDataRec RiskFactorDataRec[] 
  riskFactorDocument RiskFactorDocument[] 
  riskFactorGroupData RiskFactorGroupData[] 
  riskFactors RiskFactors[] 
  secondary_activity Activity[] @relation(name: "secondary_activity")
  users UserCompany[]
  workspace Workspace[]
}

model CompanyGroup {
  id    Int   @id  @default(autoincrement())
  name String  
  description String?
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
  companies Company[] @relation(name:"group") 
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade) 

  @@unique([id, companyId])
}

model CompanyCharacterization {
  id   String    @id @default(uuid())
  name String  
  photos CompanyCharacterizationPhoto[]
  description String?
  created_at DateTime @default(now())
  considerations String[]
  activities String[]  
  profiles CompanyCharacterization[]  @relation(name:"profiles") 
  profileName String?  
  profileParent CompanyCharacterization? @relation(name:"profiles", fields: [profileParentId], references: [id], onDelete: Cascade, onUpdate: Cascade) 
  profileParentId String?
  order Int?
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  type CharacterizationTypeEnum
  noiseValue String?  
  temperature String?  
  luminosity String?  
  moisturePercentage String?   
  workspaceId String
  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  homogeneousGroup HomogeneousGroup? @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: Cascade) 
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  
  @@unique([workspaceId, companyId, id])
}

model CompanyCharacterizationPhoto {
  id   String    @id @default(uuid())
  name String  
  isVertical Boolean @default(false)
  photoUrl String
  created_at DateTime @default(now())
  order Int?
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  companyCharacterizationId String
  companyEnvironment CompanyCharacterization @relation(fields: [companyCharacterizationId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
}

model CompanyEnvironment {
  id   String    @id @default(uuid())
  name String  
  photos CompanyEnvironmentPhoto[]
  description String?
  order Int?
  considerations String[]
  activities String[]  
  created_at DateTime @default(now())
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  type CompanyEnvironmentTypesEnum 
  noiseValue String?  
  temperature String?  
  luminosity String?  
  moisturePercentage String?   
  workspaceId String
  workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  parentEnvironmentId String?
  parentEnvironment CompanyEnvironment? @relation(name: "parent_enviroment",fields: [parentEnvironmentId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  childEnvironments CompanyEnvironment[] @relation(name: "parent_enviroment")
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
  homogeneousGroup HomogeneousGroup? @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: Cascade) 
  
  @@unique([workspaceId, companyId, id])
}

model CompanyEnvironmentPhoto {
  id   String    @id @default(uuid())
  name String  
  isVertical Boolean @default(false)
  order Int?
  photoUrl String
  created_at DateTime @default(now())
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  companyEnvironmentId String
  companyEnvironment CompanyEnvironment @relation(fields: [companyEnvironmentId], references: [id], onDelete: Restrict, onUpdate: Cascade) 
}

model Contract {
  receivingServiceCompany   Company @relation(fields: [receivingServiceCompanyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  applyingServiceCompany  Company @relation(name: "contracts", fields: [applyingServiceCompanyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  applyingServiceCompanyId String 
  receivingServiceCompanyId String 
  status StatusEnum @default(ACTIVE)
  created_at DateTime @default(now())
 
  @@id([applyingServiceCompanyId, receivingServiceCompanyId])
}

model DatabaseTable {
  id    Int     @default(autoincrement())
  name String 
  version Int  @default(1)
  companyId String
  system Boolean
  status StatusEnum @default(ACTIVE)
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt

  @@id([id, companyId])
} 

model Employee {
  id    Int   @id  @default(autoincrement())
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
  status StatusEnum @default(ACTIVE)
  name String 
  cpf String 
  companyId String
  hierarchyId String
  birthdate DateTime?
  admissionDate DateTime?
  workspaces Workspace[]
  hierarchy Hierarchy @relation(fields: [hierarchyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  
  @@unique([id, companyId])
  @@unique([cpf, companyId])
} 

model Epi {
  id    Int     @default(autoincrement()) @id
  ca String
  isValid Boolean?  
  national Boolean @default(true)
  expiredDate DateTime?
  description String @default("")
  report String @default("")
  restriction String @default("")
  observation String @default("")
  equipment String @default("")
  status StatusEnum @default(ACTIVE)
  created_at DateTime @default(now())
  deleted_at DateTime? 
  epiToRiskFactorData EpiToRiskFactorData[]

  @@index(ca)
  @@unique([ca, status])
} 

model EpiToRiskFactorData {
  epiId    Int   @map("A") 
  riskFactorDataId String @map("B") 
  riskFactorData RiskFactorData  @relation(fields: [riskFactorDataId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  epi Epi  @relation(fields: [epiId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  lifeTimeInDays Int?
  efficientlyCheck Boolean @default(false)
  epcCheck Boolean @default(false)
  longPeriodsCheck Boolean @default(false)
  validationCheck Boolean @default(false)
  tradeSignCheck Boolean @default(false)
  sanitationCheck Boolean @default(false)
  maintenanceCheck Boolean @default(false)
  unstoppedCheck Boolean @default(false)
  trainingCheck Boolean @default(false)

  @@id([riskFactorDataId, epiId])
  @@map("_EpiToRiskFactorData")
} 

model GenerateSource {
  id    String   @id  @default(uuid())
  riskId    String    
  name String
  companyId String
  system Boolean @default(false)
  created_at DateTime @default(now())
  status StatusEnum @default(ACTIVE)
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  risk RiskFactors @relation(fields: [riskId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  deleted_at DateTime? 
  recMeds RecMed[] 
  riskFactorData RiskFactorData[]

  @@unique([id, companyId])
} 

model Hierarchy {
  id    String     @default(uuid())  @id
  created_at DateTime @default(now())
  status StatusEnum @default(ACTIVE)
  type HierarchyEnum 
  description String @default("")
  realDescription String @default("")
  name String   
  companyId String
  parentId  String?
  refName  String?
  workspaces Workspace[]
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  parent Hierarchy?  @relation(name: "children_parent", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  children Hierarchy[] @relation(name: "children_parent")
  employees Employee[] 
  hierarchyOnHomogeneous HierarchyOnHomogeneous[]
  riskFactorDatas RiskFactorData[] 

  @@unique([id, companyId])
  @@index(companyId)
}

model HierarchyOnHomogeneous {
  hierarchy       Hierarchy     @relation(fields: [hierarchyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  hierarchyId     String
  homogeneousGroup   HomogeneousGroup @relation(fields: [homogeneousGroupId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  homogeneousGroupId     String
  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  workspaceId     String

  @@id([hierarchyId, homogeneousGroupId, workspaceId])
}

model HomogeneousGroup {
  id    String     @default(uuid()) @id
  name String
  description String 
  companyId String
  status StatusEnum @default(ACTIVE)
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  characterization CompanyCharacterization?
  environment CompanyEnvironment?
  hierarchyOnHomogeneous HierarchyOnHomogeneous[] 
  created_at DateTime @default(now())
  riskFactorData RiskFactorData[] 
  type HomoTypeEnum?
  
  @@unique([name, companyId])
  @@index(name)
  @@index(companyId)
}

model InviteUsers {
  id   String @id @default(uuid())
  expires_date DateTime
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  companiesIds String[]
  email String 
  roles String[]
  permissions String[]
  groupId Int?
  group AccessGroups? @relation(fields: [groupId], references: [id], onDelete: Cascade, onUpdate: Cascade) 
}

model License {
  id    Int     @default(autoincrement()) @id
  companies   Company[] @relation(name:"license")
  companyId String  @unique
  status StatusEnum @default(ACTIVE)
  created_at DateTime @default(now())

  @@index(companyId)
}

model Professional {
  id   String    @id @default(uuid())
  name String
  formation String[]
  certifications String[]
  cpf String?
  crea String?
  created_at DateTime @default(now())
  deleted_at DateTime? 
  updated_at  DateTime   @updatedAt
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade) 
  riskFactorGroupData RiskFactorGroupData[]
}

model RecMed {
  id    String   @id  @default(uuid())
  riskId    String    
  recName String? 
  medName String? 
  companyId String
  generateSourceId    String?    
  system Boolean 
  medType MeasuresTypeEnum?
  recType RecTypeEnum?
  status StatusEnum @default(ACTIVE)
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  risk RiskFactors @relation(fields: [riskId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  generateSource GenerateSource? @relation(fields: [generateSourceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  deleted_at DateTime? 
  created_at DateTime @default(now())
  recs RiskFactorData[]  @relation(name: "recs")
  engs RiskFactorData[]  @relation(name: "engs")
  adms RiskFactorData[]  @relation(name: "adms")
  dataRecs RiskFactorDataRec[]

  @@unique([id, companyId])
} 

model RefreshToken {
  id   String @id @default(uuid())
  refresh_token String
  expires_date DateTime
  created_at DateTime @default(now())
  userId Int
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model RiskFactors {
  id    String   @id  @default(uuid())
  name String 
  companyId String
  severity Int  @default(0)
  system Boolean @default(false)
  appendix String? 
  risk String? 
  propagation String[] 
  exame String?
  symptoms String?
  method String?
  unit String?
  cas String?
  breather String?
  nr15lt String?
  twa String?
  stel String?
  ipvs String?
  pv String?
  pe String?
  isEmergency Boolean  @default(false)
  carnogenicityACGIH String?
  carnogenicityLinach String?
  status StatusEnum @default(ACTIVE)
  type RiskFactorsEnum
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  created_at DateTime @default(now())
  deleted_at DateTime? 
  recMed RecMed[]
  generateSource GenerateSource[]
  representAll Boolean @default(false)
  riskFactorData RiskFactorData[]
  riskFactorProbability RiskFactorProbability[]
  json Json?
  
  @@unique([id, companyId])
}

model RiskFactorDocument {
  id    String   @id  @default(uuid())
  fileUrl String?
  name String 
  description String @default("")
  version String  @default("1.0.0")
  companyId String
  riskGroupId String
  workspaceName String
  workspaceId String
  elaboratedBy String?
  revisionBy String?
  approvedBy String?
  validity String?
  workspace Workspace @relation(fields: [workspaceId,companyId], references: [id,companyId], onDelete: Cascade, onUpdate: Cascade)
  status StatusEnum @default(ACTIVE)
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  riskGroup RiskFactorGroupData @relation(fields: [riskGroupId, companyId], references: [id, companyId], onDelete: Restrict, onUpdate: Cascade)
  attachments Attachments[]
  @@unique([id, companyId])
} 

model RiskFactorGroupData {
  id    String   @id  @default(uuid())
  name String?
  created_at DateTime @default(now())
  companyId String
  source String?
  elaboratedBy String?
  coordinatorBy String?
  revisionBy String?
  approvedBy String?
  validity String?
  visitDate DateTime?
  isQ5 Boolean @default(false)
  validityStart DateTime?
  validityEnd DateTime?
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  data RiskFactorData[]
  docs RiskFactorDocument[]
  status StatusEnum @default(PROGRESS)
  professionals Professional[]
  users User[]
  complementaryDocs String[]
  complementarySystems String[]
  months_period_level_5 Int @default(3)
  months_period_level_4 Int @default(6)
  months_period_level_3 Int @default(12)
  months_period_level_2 Int @default(24)

  @@unique([id, companyId])
}

model RiskFactorData {
  id    String   @id  @default(uuid())
  probability Int?
  probabilityAfter Int?
  probabilityCalc RiskFactorProbability? @relation(name: "RiskFactorProbabilityBefore")
  probabilityAfterCalc RiskFactorProbability? @relation(name: "RiskFactorProbabilityAfter")
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  riskId    String
  riskFactor RiskFactors @relation(fields: [riskId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  homogeneousGroupId String?
  homogeneousGroup HomogeneousGroup? @relation(fields: [homogeneousGroupId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  hierarchyId String?
  hierarchy Hierarchy? @relation(fields: [hierarchyId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  riskFactorGroupDataId String
  riskFactorGroupData RiskFactorGroupData @relation(fields: [riskFactorGroupDataId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  generateSources GenerateSource[]
  recs RecMed[]  @relation(name: "recs")
  engs RecMed[]  @relation(name: "engs")
  adms RecMed[]  @relation(name: "adms")
  dataRecs RiskFactorDataRec[]
  json Json?
  level    Int?
  epiToRiskFactorData EpiToRiskFactorData[]

  @@unique([id, companyId])
  @@unique([homogeneousGroupId, riskId, riskFactorGroupDataId])
  @@unique([hierarchyId, riskId, riskFactorGroupDataId])
  @@unique([id, riskId, riskFactorGroupDataId])
}

model RiskFactorProbability {
  id    String   @id  @default(uuid())
  intensity Int?
  intensityResult Float?
  intensityLt Float?
  minDurationJT Int?
  minDurationEO Int?
  chancesOfHappening Int?
  frequency Int?
  history Int?
  medsImplemented Int?
  riskFactorDataAfterId String?
  riskFactorDataId String?
  riskId    String
  riskFactorGroupDataId String?
  riskFactor RiskFactors @relation(fields: [riskId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  riskFactorData RiskFactorData? @relation(name: "RiskFactorProbabilityBefore", fields: [riskFactorDataId,riskId,riskFactorGroupDataId], references: [id,riskId,riskFactorGroupDataId], onDelete: Restrict, onUpdate: Cascade)
  riskFactorDataAfter RiskFactorData? @relation(name: "RiskFactorProbabilityAfter", fields: [riskFactorDataAfterId,riskId,riskFactorGroupDataId], references: [id,riskId,riskFactorGroupDataId], onDelete: Restrict, onUpdate: Cascade)

  @@unique([riskFactorDataId,riskId,riskFactorGroupDataId])
  @@unique([riskFactorDataAfterId,riskId,riskFactorGroupDataId])
}

model RiskFactorDataRec {
  id    String   @id  @default(uuid())
  responsibleName    String?
  endDate    DateTime?
  status    StatusEnum @default(PENDING)
  recMedId String
  riskFactorDataId String
  recMed RecMed @relation(fields: [recMedId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  riskFactorData RiskFactorData @relation(fields: [riskFactorDataId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  comments RiskFactorDataRecComments[]
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  @@unique([riskFactorDataId, recMedId, companyId])
}

model RiskFactorDataRecComments {
  id    String   @id  @default(uuid())
  text    String
  type    RiskRecTypeEnum
  textType    RiskRecTextTypeEnum
  riskFactorDataRecId String
  riskFactorDataRec RiskFactorDataRec @relation(fields: [riskFactorDataRecId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
}

model User {
  id    Int     @default(autoincrement()) @id
  email String  @unique
  name String?
  formation String[]
  certifications String[]
  cpf String?
  crea String? 
  googleExternalId String? 
  facebookExternalId String? 
  password String
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
  deleted_at DateTime? 
  refresh_token RefreshToken[]
  companies UserCompany[]
  riskFactorGroupData RiskFactorGroupData[]
  
  @@unique([id, name])
}

model UserCompany {
  roles String[]
  permissions String[]
  groupId Int?
  group AccessGroups? @relation(fields: [groupId], references: [id], onDelete: SetNull, onUpdate: Cascade) 
  status StatusEnum @default(ACTIVE)
  userId Int
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade) 
  companyId String
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade, onUpdate: Cascade) 
  created_at DateTime @default(now())
  updated_at  DateTime   @updatedAt
  
  @@id([companyId, userId])
}

model Workspace {
  id    String  @id   @default(uuid()) 
  name String  
  abbreviation String?
  description String?  
  cnpj String?  
  companyJson Json?  
  created_at DateTime @default(now())
  isOwner Boolean @default(true)
  updated_at  DateTime   @updatedAt
  companyId String
  status StatusEnum @default(ACTIVE)
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  address Address?
  employee Employee[]
  riskFactorDocument RiskFactorDocument[]
  hierarchyOnHomogeneous HierarchyOnHomogeneous[]
  hierarchy Hierarchy[]
  companyEnvironment CompanyEnvironment[]
  characterization CompanyCharacterization[]

  @@unique([abbreviation, companyId])
  @@unique([id, companyId])
}


